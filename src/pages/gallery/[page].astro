---
import Layout from '../../layouts/Layout.astro';
import { getImagesInfo } from '../../utils/getImagesInfo';

export async function getStaticPaths() {
  const rootDirectory = Astro.root ?? process.cwd();
  const { totalPages } = getImagesInfo(rootDirectory);
  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) }
  }));
}

const rootDirectory = Astro.root ?? process.cwd();
const { files, perPage, totalPages } = getImagesInfo(rootDirectory);
const { page } = Astro.params;
const currentPage = parseInt(page, 10);
const start = (currentPage - 1) * perPage;
const images = files.slice(start, start + perPage);
---

<Layout title={`Gallery - Page ${currentPage}`} activePage="gallery">
  <br>
  <br>
  <h1>My Photos - Page {currentPage}</h1>
  <p>Here are pictures I have enjoyed taking over the years to record my memories, experiences and travels.</p>
  <br>
  <br>
  <nav class="pagination">
    {currentPage > 1 && (
      <a href={`/gallery/${currentPage - 1}`}>&laquo; Previous</a>
    )}
    {Array.from({ length: totalPages }, (_, i) => {
      const pageNum = i + 1;
      return (
        <a
          href={`/gallery/${pageNum}`}
          class={pageNum === currentPage ? 'active' : ''}
        >
          {pageNum}
        </a>
      );
    })}
    {currentPage < totalPages && (
      <a href={`/gallery/${currentPage + 1}`}>Next &raquo;</a>
    )}
  </nav>

  <div class="gallery-full">
    {images.map((image) => (
      <img src={`/images/${image}`} alt="Gallery image" loading="lazy" class="clickable" />
    ))}
  </div>
  
  <!-- Pagination Navigation -->
  <nav class="pagination">
    {currentPage > 1 && (
      <a href={`/gallery/${currentPage - 1}`}>&laquo; Previous</a>
    )}
    {Array.from({ length: totalPages }, (_, i) => {
      const pageNum = i + 1;
      return (
        <a
          href={`/gallery/${pageNum}`}
          class={pageNum === currentPage ? 'active' : ''}
        >
          {pageNum}
        </a>
      );
    })}
    {currentPage < totalPages && (
      <a href={`/gallery/${currentPage + 1}`}>Next &raquo;</a>
    )}
  </nav>

  <!-- Modal for Enlarged Image -->
  <div id="modal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modal-img" alt="" src=""/>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modal-img");
      const closeBtn = document.querySelector(".close");

      document.querySelectorAll('.gallery-full img.clickable').forEach(img => {
        img.addEventListener('click', () => {
          modal.style.display = "flex"; // Use flex to center the content
          modalImg.src = img.src;
        });
      });

      closeBtn.addEventListener('click', () => {
        modal.style.display = "none";
      });

      // Close modal when clicking outside the image
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>
</Layout>
